<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Find Talented Interns</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üè¢</text></svg>">
  <style>
/* Import Google Font */
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');

/* Reset and Base Styles */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

:root {
  /* Same color scheme as other pages */
  --background: #1A1F2C;
  --foreground: #F9F7F7;
  --card: #111824;
  --card-foreground: #F9F7F7;
  --primary: #334155;
  --primary-hover: #1E293B;
  --border: rgba(255, 255, 255, 0.1);
  --input-bg: rgba(255, 255, 255, 0.04);
  --error: #DC2626;
  --success: #10B981;
  --radius: 0.6rem;
  --shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
  --accent: #E6A55E;
  --accent-hover: #D89144;
}

body {
  font-family: 'Poppins', sans-serif;
  background-color: var(--background);
  color: var(--foreground);
  line-height: 1.6;
  min-height: 100vh;
}

/* Navigation Bar */
.navbar {
  background-color: var(--card);
  border-bottom: 1px solid var(--border);
  padding: 1rem 0;
  position: sticky;
  top: 0;
  z-index: 100;
  box-shadow: var(--shadow);
}

.toast {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: var(--success);
  color: white;
  padding: 15px 20px;
  border-radius: var(--radius);
  display: none;
  z-index: 1000;
  box-shadow: var(--shadow);
}

.toast.error {
  background: var(--error);
}

.toast.show {
  display: block;
}

/* Floating Action Button */
.fab {
  position: fixed;
  bottom: 30px;
  right: 30px;
  width: 60px;
  height: 60px;
  background: var(--accent);
  border: none;
  border-radius: 50%;
  color: white;
  font-size: 24px;
  font-weight: bold;
  cursor: pointer;
  box-shadow: 0 4px 20px rgba(230, 165, 94, 0.4);
  transition: all 0.3s ease;
  z-index: 1000;
  display: flex;
  align-items: center;
  justify-content: center;
  text-decoration: none;
}

.fab:hover {
  background: var(--accent-hover);
  transform: scale(1.1);
  box-shadow: 0 6px 25px rgba(230, 165, 94, 0.6);
}

.fab:active {
  transform: scale(0.95);
}


.nav-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 1rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.logo {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--accent);
  text-decoration: none;
}

.nav-menu {
  display: flex;
  list-style: none;
  gap: 2rem;
  align-items: center;
}

.nav-link {
  color: var(--foreground);
  text-decoration: none;
  font-weight: 500;
  transition: color 0.3s ease;
}

.nav-link:hover {
  color: var(--accent);
}

.nav-profile {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  background-color: var(--primary);
  border-radius: var(--radius);
  color: var(--foreground);
  text-decoration: none;
  transition: background-color 0.3s ease;
}

.nav-profile:hover {
  background-color: var(--primary-hover);
}

.hamburger {
  display: none;
  flex-direction: column;
  cursor: pointer;
  gap: 4px;
}

.hamburger span {
  width: 25px;
  height: 3px;
  background-color: var(--foreground);
  transition: 0.3s;
}

/* Main Content */
.main-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem 1rem;
}

.page-header {
  text-align: center;
  margin-bottom: 3rem;
}

.page-title {
  font-size: 2.5rem;
  color: var(--accent);
  margin-bottom: 0.5rem;
}

.page-subtitle {
  font-size: 1.1rem;
  color: var(--foreground);
  opacity: 0.8;
}

/* Filter Section */
.filter-section {
  background-color: var(--card);
  border-radius: var(--radius);
  padding: 1.5rem;
  margin-bottom: 2rem;
  box-shadow: var(--shadow);
}

.filter-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
}

.filter-title {
  font-size: 1.2rem;
  font-weight: 600;
}

.clear-filters {
  background: none;
  border: 1px solid var(--border);
  color: var(--foreground);
  padding: 0.5rem 1rem;
  border-radius: var(--radius);
  cursor: pointer;
  transition: all 0.3s ease;
}

.clear-filters:hover {
  background-color: var(--primary);
}

.skills-filter {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
}

.skill-tag {
  padding: 0.5rem 1rem;
  background-color: var(--input-bg);
  border: 1px solid var(--border);
  border-radius: 20px;
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 0.9rem;
}

.skill-tag:hover {
  background-color: var(--primary);
}

.skill-tag.selected {
  background-color: var(--accent);
  color: var(--background);
  border-color: var(--accent);
}

/* Sort Section */
.sort-section {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 2rem;
  padding: 1rem;
  background-color: var(--card);
  border-radius: var(--radius);
}

.results-count {
  font-weight: 500;
}

.sort-dropdown {
  background-color: var(--input-bg);
  border: 1px solid var(--border);
  color: var(--foreground);
  padding: 0.5rem 1rem;
  border-radius: var(--radius);
  cursor: pointer;
}

/* Profiles Grid */
.profiles-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
  gap: 1.5rem;
  margin-bottom: 2rem;
}

.profile-card {
  background-color: var(--card);
  border-radius: var(--radius);
  padding: 1.5rem;
  box-shadow: var(--shadow);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  cursor: pointer;
  border: 1px solid var(--border);
}

.profile-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 12px 40px rgba(0, 0, 0, 0.6);
}

.profile-header {
  display: flex;
  align-items: center;
  gap: 1rem;
  margin-bottom: 1rem;
}

.profile-picture {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  object-fit: cover;
  border: 2px solid var(--accent);
}

.profile-picture-placeholder {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background-color: var(--primary);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  color: var(--accent);
}

.profile-info h3 {
  font-size: 1.2rem;
  margin-bottom: 0.25rem;
}

.profile-headline {
  color: var(--foreground);
  opacity: 0.8;
  font-size: 0.9rem;
}

.profile-skills {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  margin-bottom: 1rem;
}

.profile-skill {
  padding: 0.25rem 0.75rem;
  background-color: var(--input-bg);
  border-radius: 15px;
  font-size: 0.8rem;
  border: 1px solid var(--border);
}

.profile-skill.matched {
  background-color: var(--accent);
  color: var(--background);
  border-color: var(--accent);
}

.profile-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 1rem;
  padding-top: 1rem;
  border-top: 1px solid var(--border);
}

.match-score {
  background-color: var(--success);
  color: white;
  padding: 0.25rem 0.75rem;
  border-radius: 15px;
  font-size: 0.8rem;
  font-weight: 600;
}

.view-profile-btn {
  background-color: var(--accent);
  color: var(--background);
  border: none;
  padding: 0.5rem 1rem;
  border-radius: var(--radius);
  cursor: pointer;
  font-weight: 500;
  transition: background-color 0.3s ease;
}

.view-profile-btn:hover {
  background-color: var(--accent-hover);
}

/* Loading and Empty States */
.loading {
  text-align: center;
  padding: 3rem;
  font-size: 1.1rem;
  color: var(--foreground);
  opacity: 0.7;
}

.no-results {
  text-align: center;
  padding: 3rem;
  color: var(--foreground);
  opacity: 0.7;
}

.no-results h3 {
  margin-bottom: 1rem;
  font-size: 1.5rem;
}



      /* Skills Dropdown Styles */
      .skills-dropdown-container {
        margin-bottom: 1rem;
      }
      
      .skills-dropdown {
        width: 100%;
        padding: 0.75rem 1rem;
        background-color: var(--input-bg);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        color: var(--foreground);
        font-family: 'Poppins', sans-serif;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
      }
      
      .skills-dropdown:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 0 2px rgba(230, 165, 94, 0.2);
      }
      
      .skills-dropdown option {
        background-color: var(--card);
        color: var(--foreground);
        padding: 0.5rem;
      }
      
      .skills-dropdown optgroup {
        background-color: var(--primary);
        color: var(--accent);
        font-weight: 600;
        font-style: normal;
      }
      
/* Toast Notifications */
.toast {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: var(--success);
  color: white;
  padding: 15px 20px;
  border-radius: var(--radius);
  display: none;
  z-index: 1000;
  box-shadow: var(--shadow);
}

.toast.error {
  background: var(--error);
}

.toast.show {
  display: block;
}

/* Responsive Design */
@media (max-width: 768px) {
  .hamburger {
    display: flex;
  }

  .nav-menu {
    position: fixed;
    left: -100%;
    top: 70px;
    flex-direction: column;
    background-color: var(--card);
    width: 100%;
    text-align: center;
    transition: 0.3s;
    box-shadow: var(--shadow);
    padding: 2rem 0;
  }

  .nav-menu.active {
    left: 0;
  }

  .page-title {
    font-size: 2rem;
  }

  .profiles-grid {
    grid-template-columns: 1fr;
  }

  .sort-section {
    flex-direction: column;
    gap: 1rem;
    align-items: stretch;
  }

  .filter-header {
    flex-direction: column;
    gap: 1rem;
    align-items: stretch;
  }
}

@media (max-width: 480px) {
  .main-container {
    padding: 1rem 0.5rem;
  }

  .profile-card {
    padding: 1rem;
  }

  .profile-header {
    flex-direction: column;
    text-align: center;
  }
}

/* Load More Card Styles */
.load-more-card {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border: 2px dashed #8b94d6;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 200px;
  position: relative;
  overflow: hidden;
  transition: all 0.3s ease;
}

.load-more-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
  border-color: #667eea;
}

.load-more-content {
  text-align: center;
  color: white;
  z-index: 2;
}

.load-more-icon {
  font-size: 3rem;
  margin-bottom: 1rem;
  opacity: 0.8;
}

.load-more-content h3 {
  font-size: 1.5rem;
  margin-bottom: 0.5rem;
  font-weight: 600;
}

.load-more-content p {
  font-size: 1rem;
  margin-bottom: 1.5rem;
  opacity: 0.9;
}

.load-more-btn {
  background: rgba(255, 255, 255, 0.2);
  border: 2px solid rgba(255, 255, 255, 0.3);
  color: white;
  padding: 12px 24px;
  border-radius: 30px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
}

.load-more-btn:hover:not(:disabled) {
  background: rgba(255, 255, 255, 0.3);
  border-color: rgba(255, 255, 255, 0.5);
  transform: scale(1.05);
}

.load-more-btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

.load-more-card::before {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
  animation: shimmer 3s infinite;
}

@keyframes shimmer {
  0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
  100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
}

/* Match Score Styling */
.match-score {
  background: linear-gradient(135deg, #00d4aa, #00b894);
  color: white;
  padding: 4px 8px;
  border-radius: 12px;
  font-size: 0.8rem;
  font-weight: 600;
  display: inline-block;
}

/* Matched Skills Highlighting */
.profile-skill.matched {
  background: linear-gradient(135deg, #00d4aa, #00b894);
  color: white;
  font-weight: 600;
  transform: scale(1.05);
  box-shadow: 0 2px 8px rgba(0, 212, 170, 0.3);
}
  </style>
</head>
<body>
  <!-- Navigation Bar -->
  <nav class="navbar">
    <div class="nav-container">
      <a href="/" class="logo">InternConnect</a>
      
      <ul class="nav-menu" id="nav-menu">
        <li><a href="/startups/home" class="nav-link">Home</a></li>
        <li><a href="#" class="nav-link">Messages</a></li>
        <li><a href="#" class="nav-link">Profile</a></li>
        <li><a href="#" class="nav-profile">üë§ Profile</a></li>
      </ul>
      
      <div class="hamburger" id="hamburger">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="main-container">
    <!-- Page Header -->
    <div class="page-header">
      <h1 class="page-title">Find Talented Interns</h1>
      <p class="page-subtitle">Discover skilled interns that match your requirements</p>
    </div>

    <!-- Filter Section -->
    <div class="filter-section">
      <div class="filter-header">
        <h3 class="filter-title">Filter by Skills</h3>
        <button class="clear-filters" onclick="clearAllFilters()">Clear All</button>
      </div>
      
      <!-- Skills Dropdown -->
      <div class="skills-dropdown-container" style="margin-bottom: 1rem;">
        <select id="skills-dropdown" class="skills-dropdown" onchange="addSkillFromDropdown()">
          <option value="">Select a skill to filter...</option>
          <optgroup label="Programming Languages">
            <option value="Python">Python</option>
            <option value="JavaScript">JavaScript</option>
            <option value="Java">Java</option>
            <option value="C++">C++</option>
            <option value="C#">C#</option>
            <option value="Ruby">Ruby</option>
            <option value="PHP">PHP</option>
            <option value="Swift">Swift</option>
            <option value="Kotlin">Kotlin</option>
            <option value="Go">Go</option>
          </optgroup>
          <optgroup label="Web Development">
            <option value="HTML5">HTML5</option>
            <option value="CSS3">CSS3</option>
            <option value="React">React</option>
            <option value="Angular">Angular</option>
            <option value="Vue.js">Vue.js</option>
            <option value="Node.js">Node.js</option>
            <option value="Express.js">Express.js</option>
            <option value="Django">Django</option>
            <option value="Flask">Flask</option>
            <option value="Laravel">Laravel</option>
          </optgroup>
          <optgroup label="Databases">
            <option value="MySQL">MySQL</option>
            <option value="PostgreSQL">PostgreSQL</option>
            <option value="MongoDB">MongoDB</option>
            <option value="Redis">Redis</option>
            <option value="SQLite">SQLite</option>
            <option value="Oracle">Oracle</option>
          </optgroup>
          <optgroup label="DevOps & Tools">
            <option value="Git">Git</option>
            <option value="Docker">Docker</option>
            <option value="Kubernetes">Kubernetes</option>
            <option value="AWS">AWS</option>
            <option value="Azure">Azure</option>
            <option value="Google Cloud Platform">Google Cloud Platform</option>
            <option value="Jenkins">Jenkins</option>
            <option value="CI/CD">CI/CD</option>
          </optgroup>
          <optgroup label="Data Science & AI">
            <option value="Machine Learning">Machine Learning</option>
            <option value="Deep Learning">Deep Learning</option>
            <option value="TensorFlow">TensorFlow</option>
            <option value="PyTorch">PyTorch</option>
            <option value="Data Analysis">Data Analysis</option>
            <option value="Data Visualization">Data Visualization</option>
          </optgroup>
          <optgroup label="Mobile Development">
            <option value="React Native">React Native</option>
            <option value="Flutter">Flutter</option>
            <option value="Android Development">Android Development</option>
            <option value="iOS Development">iOS Development</option>
          </optgroup>
        </select>
      </div>
      
      <!-- Selected Skills Display -->
      <div class="skills-filter" id="skills-filter">
        <!-- Selected skills will be displayed here as tags -->
      </div>
    </div>

    <!-- Sort Section -->
    <div class="sort-section">
      <div class="results-count" id="results-count">Loading profiles...</div>
      <select class="sort-dropdown" id="sort-dropdown" onchange="sortProfiles()">
        <option value="match">Sort by: Best Match</option>
        <option value="name">Sort by: Name</option>
        <option value="skills">Sort by: Most Skills</option>
      </select>
    </div>

    <!-- Profiles Grid -->
    <div class="profiles-grid" id="profiles-grid">
      <div class="loading">Loading intern profiles...</div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div class="toast" id="toast">
    <div class="toast-content"></div>
  </div>

<script>
  let allProfiles = [];
let currentPage = 1;
let hasMore = true;
let selectedSkills = [];
let isLoading = false;
let totalCount = 0;
let allSkills = [];

// Initialize page
document.addEventListener('DOMContentLoaded', async function() {
    console.log('üöÄ Page loaded, initializing...');
    
    initializeNavigation();
    
    // Check authentication before loading profiles
    console.log('‚úÖ Loading profiles...');
    loadProfiles();
});

// Navigation functionality
function initializeNavigation() {
    const hamburger = document.getElementById('hamburger');
    const navMenu = document.getElementById('nav-menu');

    if (hamburger && navMenu) {
        hamburger.addEventListener('click', function() {
            navMenu.classList.toggle('active');
        });
    }
}

async function loadProfiles(page = 1, append = false) {
    if (isLoading) return;
    
    const profilesGrid = document.getElementById('profiles-grid');
    
    try {
        isLoading = true;
        
        // Show loading indicator
        if (!append) {
            profilesGrid.innerHTML = '<div class="loading">Loading intern profiles...</div>';
            currentPage = 1;
            allProfiles = [];
        } else {
            // Update existing load more button to show loading
            const loadMoreBtn = document.querySelector('.load-more-btn');
            if (loadMoreBtn) {
                loadMoreBtn.textContent = 'Loading...';
                loadMoreBtn.disabled = true;
            }
        }
        
        // Prepare URL with pagination params
        const params = new URLSearchParams({
            page: page.toString(),
            limit: '5'
        });
        
        // Add skills filter if any selected
        if (selectedSkills.length > 0) {
            params.append('skills', selectedSkills.join(','));
        }
        
        console.log(`üîÑ Loading page ${page} with params:`, params.toString());
        
        const response = await fetch(`/get_intern_profiles?${params}`, {
            method: 'GET',
            credentials: 'include',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            }
        });

        if (response.status === 401) {
            showToast('Please login to access profiles', 'error');
            window.location.href = '/login';
            return;
        }

        if (response.status === 403) {
            showToast('Access denied. Only startups can view intern profiles.', 'error');
            showNoResults('Access denied. Only startups can view intern profiles.');
            return;
        }

        if (!response.ok) {
            throw new Error(`Server error: ${response.status}`);
        }

        const data = await response.json();
        console.log('üìä Received data:', data);

        if (!data.success) {
            throw new Error(data.message || 'Failed to load profiles');
        }

        // Update global state
        if (append) {
            // Add new profiles to existing ones
            allProfiles = [...allProfiles, ...data.profiles];
        } else {
            // Replace profiles for new search/filter
            allProfiles = data.profiles;
        }
        
        totalCount = data.total_count;
        hasMore = data.has_more;
        currentPage = data.current_page;

        console.log(`‚úÖ Updated state: ${allProfiles.length} profiles loaded, hasMore: ${hasMore}, page: ${currentPage}`);

        // Display profiles
        displayProfiles(append);
        updateResultsCount();
        
        if (!append && data.profiles.length > 0) {
            showToast(`Loaded ${data.profiles.length} profiles!`, 'success');
        } else if (append && data.profiles.length > 0) {
            showToast(`Loaded ${data.profiles.length} more profiles!`, 'success');
        }

    } catch (error) {
        console.error('‚ùå Error loading profiles:', error);
        showToast(error.message || 'Failed to load profiles', 'error');
        
        if (!append) {
            showNoResults(error.message || 'Failed to load profiles');
        }
    } finally {
        isLoading = false;
        
        // Reset load more button if it exists
        const loadMoreBtn = document.querySelector('.load-more-btn');
        if (loadMoreBtn) {
            loadMoreBtn.textContent = 'Load More';
            loadMoreBtn.disabled = false;
        }
    }
}

// Display profiles
function displayProfiles(append = false) {
    const profilesGrid = document.getElementById('profiles-grid');
    
    if (!append) {
        profilesGrid.innerHTML = '';
    } else {
        // Remove existing load more card
        const existingLoadMore = profilesGrid.querySelector('.load-more-card');
        if (existingLoadMore) {
            existingLoadMore.remove();
        }
    }
    
    if (allProfiles.length === 0) {
        showNoResults('No interns match your selected skills. Try adjusting your filters.');
        return;
    }
    
    // Add profile cards - only add new ones if appending
    const startIndex = append ? allProfiles.length - 5 : 0;
    const profilesToShow = append ? allProfiles.slice(-5) : allProfiles;
    
    profilesToShow.forEach(profile => {
        // Check if profile card already exists (prevent duplicates)
        if (!profilesGrid.querySelector(`[data-profile-id="${profile.id}"]`)) {
            const profileCard = createProfileCard(profile);
            profilesGrid.appendChild(profileCard);
        }
    });
    
    // Add load more button if there are more profiles
    if (hasMore) {
        const loadMoreCard = createLoadMoreCard();
        profilesGrid.appendChild(loadMoreCard);
    }
}

// Create profile card
function createProfileCard(profile) {
    const card = document.createElement('div');
    card.className = 'profile-card';
    card.setAttribute('data-profile-id', profile.id);
    card.onclick = () => viewProfile(profile);
    
    const profilePicture = profile.profilePicture ? 
        `<img src="${profile.profilePicture}" alt="${profile.fullName || 'Profile'}" class="profile-picture">` :
        `<div class="profile-picture-placeholder">üë§</div>`;
    
    const skills = profile.skills && Array.isArray(profile.skills) ? 
        profile.skills.slice(0, 5).map(skill => {
            const isMatched = selectedSkills.some(selectedSkill => 
                skill.toLowerCase().includes(selectedSkill.toLowerCase())
            );
            return `<span class="profile-skill ${isMatched ? 'matched' : ''}">${skill}</span>`;
        }).join('') : '';
    
    const matchScore = selectedSkills.length > 0 && profile.match_score > 0 ? 
        `<div class="match-score">${Math.round(profile.match_score)}% match</div>` : '';
    
    // Store profile data globally for button access
    const profileId = profile.id;
    window[`profile_${profileId}`] = profile;
    
    card.innerHTML = `
        <div class="profile-header">
            ${profilePicture}
            <div class="profile-info">
                <h3>${profile.fullName || 'Anonymous'}</h3>
                <p class="profile-headline">${profile.headline || 'Aspiring Professional'}</p>
            </div>
        </div>
        
        ${skills ? `
        <div class="profile-skills">
            ${skills}
            ${profile.skills && profile.skills.length > 5 ? `<span class="profile-skill">+${profile.skills.length - 5} more</span>` : ''}
        </div>` : ''}
        
        <div class="profile-footer">
            ${matchScore}
            <button class="view-profile-btn" onclick="event.stopPropagation(); viewProfile(window.profile_${profileId})">View Profile</button>
        </div>
    `;
    
    return card;
}

// Create load more card
function createLoadMoreCard() {
    const loadMoreCard = document.createElement('div');
    loadMoreCard.className = 'profile-card load-more-card';
    loadMoreCard.innerHTML = `
        <div class="load-more-content">
            <div class="load-more-icon">üìÑ</div>
            <h3>Load More Profiles</h3>
            <p>View more talented interns</p>
            <button class="load-more-btn" onclick="loadMoreProfiles()" ${isLoading ? 'disabled' : ''}>
                ${isLoading ? 'Loading...' : 'Load More'}
            </button>
        </div>
    `;
    
    return loadMoreCard;
}

// Load more profiles
async function loadMoreProfiles() {
    if (isLoading || !hasMore) return;
    
    console.log('üîÑ Loading more profiles...');
    
    try {
        const nextPage = currentPage + 1;
        await loadProfiles(nextPage, true);
    } catch (error) {
        console.error('‚ùå Error loading more profiles:', error);
        showToast('Failed to load more profiles', 'error');
    }
}

// Extract all unique skills from profiles
function extractAllSkills() {
    const skillsSet = new Set();
    
    allProfiles.forEach(profile => {
        if (profile.skills && Array.isArray(profile.skills)) {
            profile.skills.forEach(skill => {
                if (skill && skill.trim()) {
                    skillsSet.add(skill.trim());
                }
            });
        }
    });
    
    allSkills = Array.from(skillsSet).sort();
}

// Initialize skills filter
function initializeSkillsFilter() {
    // Clear any existing selected skills
    document.getElementById('skills-filter').innerHTML = '';
    selectedSkills = [];
}

// Toggle skill filter
function toggleSkillFilter(skill, element) {
    if (selectedSkills.includes(skill)) {
        selectedSkills = selectedSkills.filter(s => s !== skill);
        element.classList.remove('selected');
    } else {
        selectedSkills.push(skill);
        element.classList.add('selected');
    }
    
    // Reset pagination when filter changes
    currentPage = 1;
    hasMore = true;
    filterProfiles();
}

// Add skill from dropdown
function addSkillFromDropdown() {
    const dropdown = document.getElementById('skills-dropdown');
    const selectedSkill = dropdown.value;
    
    if (selectedSkill && !selectedSkills.includes(selectedSkill)) {
        selectedSkills.push(selectedSkill);
        
        // Create and add skill tag
        const skillsFilter = document.getElementById('skills-filter');
        const skillTag = document.createElement('div');
        skillTag.className = 'skill-tag selected';
        skillTag.textContent = selectedSkill;
        skillTag.onclick = () => removeSkillFilter(selectedSkill, skillTag);
        skillsFilter.appendChild(skillTag);
        
        // Reset dropdown
        dropdown.value = '';
        
        // Reset pagination when filter changes
        currentPage = 1;
        hasMore = true;
        filterProfiles();
    }
}

// Remove skill filter
function removeSkillFilter(skill, element) {
    selectedSkills = selectedSkills.filter(s => s !== skill);
    element.remove();
    
    // Reset pagination when filter changes
    currentPage = 1;
    hasMore = true;
    filterProfiles();
}

// Clear all filters
function clearAllFilters() {
    selectedSkills = [];
    document.getElementById('skills-filter').innerHTML = '';
    const dropdown = document.getElementById('skills-dropdown');
    if (dropdown) {
        dropdown.value = '';
    }
    
    // Reset pagination when filter changes
    currentPage = 1;
    hasMore = true;
    filterProfiles();
}

// Filter profiles based on selected skills
async function filterProfiles() {
    console.log('üîç Filtering profiles with skills:', selectedSkills);
    
    // Reset pagination state
    currentPage = 1;
    hasMore = true;
    allProfiles = [];
    
    // Load profiles with current filters
    await loadProfiles(1, false);
}

// View individual profile
function viewProfile(profile) {
    console.log('üëÅÔ∏è Viewing profile:', profile);
    
    // Store profile data for the detail page
    localStorage.setItem('selectedInternProfile', JSON.stringify(profile));
    
    // Navigate to profile detail page
    window.location.href = '/intern/profile/view';
}

// Update results count
function updateResultsCount() {
    const resultsCount = document.getElementById('results-count');
    if (!resultsCount) return;
    
    if (selectedSkills.length > 0) {
        resultsCount.textContent = `Showing ${allProfiles.length} of ${totalCount} matching interns`;
    } else {
        resultsCount.textContent = `Showing ${allProfiles.length} of ${totalCount} interns`;
    }
}

// Show no results message
function showNoResults(message) {
    const profilesGrid = document.getElementById('profiles-grid');
    profilesGrid.innerHTML = `
        <div class="no-results">
            <h3>No Results Found</h3>
            <p>${message}</p>
        </div>
    `;
    
    const resultsCount = document.getElementById('results-count');
    if (resultsCount) {
        resultsCount.textContent = '0 interns found';
    }
}

// Toast notification system
function showToast(message, type = 'info') {
    const toast = document.getElementById('toast');
    if (!toast) return;
    
    const toastContent = toast.querySelector('.toast-content');
    if (!toastContent) return;
    
    toast.className = 'toast show ' + type;
    toastContent.textContent = message;
    
    setTimeout(() => {
        toast.className = 'toast';
    }, 3000);
}

// Check authentication
async function checkAuth() {
    try {
        const response = await fetch('/get_intern_profiles', {
            method: 'HEAD',
            credentials: 'include'
        });
        
        console.log('üîê Auth check status:', response.status);
        return response.status !== 401;
        
    } catch (error) {
        console.error('üîê Auth check failed:', error);
        return false;
    }
}

// Sort profiles functionality (if needed)
function sortProfiles() {
    const sortBy = document.getElementById('sort-dropdown');
    if (!sortBy) return;
    
    const sortValue = sortBy.value;
    
    // Since we're using server-side sorting, we need to reload profiles
    // The backend already handles sorting by match score
    console.log('üîÑ Sort changed to:', sortValue);
    
    // Reset and reload profiles
    currentPage = 1;
    hasMore = true;
    allProfiles = [];
    loadProfiles(1, false);
}
</script>

<a href="/startups/post" class="fab" title="Create New Post">
  +
</a>

</body>
</html>
